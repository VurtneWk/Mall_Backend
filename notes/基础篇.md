## P06-P10

没有安装虚拟机，直接使用的orbstack

### Q1： OrbStack无法下载镜像

```xml
 cat ~/.orbstack/config/docker.json
{
    "proxies": {
        "http-proxy": "http://127.0.0.1:7890",
        "https-proxy": "http://127.0.0.1:7890",
        "no-proxy": "localhost,127.0.0.1"
    }
}%
```

直接添加代理，测试了很多镜像加速服务都失败了

参考：https://adoyle.me/Today-I-Learned/docker/docker-proxy.html

### Q2：Docker 教程

https://www.bilibili.com/video/BV1wQ4y1Y7SE?spm_id_from=333.788.videopod.episodes&vd_source=2995bcb8e7173947cba0199ac9669d1b&p=1

### Q3: Mysql安装

##### 下载

```shell
docker pull mysql:8.0
```

##### 创建volume

```shell
 vurtnewk@wenkedeMacBook-Pro  ~/Documents/data/video/tools  docker volume create mysql-log
mysql-log
 vurtnewk@wenkedeMacBook-Pro  ~/Documents/data/video/tools  docker volume create mysql-data
mysql-data
 vurtnewk@wenkedeMacBook-Pro  ~/Documents/data/video/tools  docker volume create mysql-conf
mysql-conf
```

##### 运行

```shell
docker run -p 3306:3306 --name mysql \
-v mysql-log:/var/log/mysql \
-v mysql-data:/var/lib/mysql \
-v mysql-conf:/etc/mysql/conf.d \
-e MYSQL_ROOT_PASSWORD=123456 \
-d mysql:8.0
```

##### 运行结果查询

```shell
docker ps
CONTAINER ID   IMAGE       COMMAND                   CREATED          STATUS          PORTS                                                    NAMES
3f9f421afe96   mysql:8.0   "docker-entrypoint.s…"   16 seconds ago   Up 16 seconds   33060/tcp, 0.0.0.0:3307->3306/tcp, [::]:3307->3306/tcp   mysql
```

##### 进入mysql

```shell
docker exec -it mysql bash  
```

#### 进行授权远程连接授权

默认情况下远程连接会出现 Public Key Retrival错误

- 更改加密规则

```shell
ALTER USER 'root'@'localhost' IDENTIFIED BY 'password' PASSWORD EXPIRE NEVER;
```

- 更新root用户密码

```shell
# root'@'% 任意主机
# root'@'localhost 本地


ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '123456';
# 不然不能进行本地命令行登录
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456';

#验证 plugin 不是 caching_sha2_password
mysql> SELECT user, host, plugin FROM mysql.user WHERE user='root';
+------+-----------+-----------------------+
| user | host      | plugin                |
+------+-----------+-----------------------+
| root | %         | mysql_native_password |
| root | localhost | mysql_native_password |
+------+-----------+-----------------------+
2 rows in set (0.00 sec)

```

- 刷新权限

```shell
flush privileges;
```

#### 配置字符集

- 查看字符集

```shell
mysql> SHOW VARIABLES LIKE 'character_set%';
+--------------------------+--------------------------------+
| Variable_name            | Value                          |
+--------------------------+--------------------------------+
| character_set_client     | latin1                         |
| character_set_connection | latin1                         |
| character_set_database   | utf8mb4                        |
| character_set_filesystem | binary                         |
| character_set_results    | latin1                         |
| character_set_server     | utf8mb4                        |
| character_set_system     | utf8mb3                        |
| character_sets_dir       | /usr/share/mysql-8.0/charsets/ |
+--------------------------+--------------------------------+
8 rows in set (0.01 sec)

mysql> SHOW VARIABLES LIKE 'collation%';
+----------------------+--------------------+
| Variable_name        | Value              |
+----------------------+--------------------+
| collation_connection | latin1_swedish_ci  |
| collation_database   | utf8mb4_0900_ai_ci |
| collation_server     | utf8mb4_0900_ai_ci |
+----------------------+--------------------+
3 rows in set (0.00 sec)
```

- 重新配置

```shell
mysql> SHOW VARIABLES LIKE 'character_set%';
+--------------------------+--------------------------------+
| Variable_name            | Value                          |
+--------------------------+--------------------------------+
| character_set_client     | utf8mb4                        |
| character_set_connection | utf8mb4                        |
| character_set_database   | utf8mb4                        |
| character_set_filesystem | binary                         |
| character_set_results    | utf8mb4                        |
| character_set_server     | utf8mb4                        |
| character_set_system     | utf8mb3                        |
| character_sets_dir       | /usr/share/mysql-8.0/charsets/ |
+--------------------------+--------------------------------+
8 rows in set (0.00 sec)

mysql> SHOW VARIABLES LIKE 'collation%';
+----------------------+--------------------+
| Variable_name        | Value              |
+----------------------+--------------------+
| collation_connection | utf8mb4_unicode_ci |
| collation_database   | utf8mb4_unicode_ci |
| collation_server     | utf8mb4_unicode_ci |
+----------------------+--------------------+
3 rows in set (0.00 sec)
```



## P11 

### Q1: 安装Redis

```shell
# 创建一个 Redis 专用的 Volume
docker volume create redis-data
docker volume create redis-conf

# 启动 Redis 容器，并将 Volume 挂载到对应的目录
docker run -p 6379:6379 --name redis \
-v redis-data:/data \
-v redis-conf:/etc/redis \
-d redis redis-server /etc/redis/redis.conf
```

> [!caution]
>
> Fatal error, can't open config file '/etc/redis/redis.conf': No such file or directory

```shell
# 将配置文件写入 redis-conf Volume 中：
docker run --rm -v redis-conf:/data busybox \
    sh -c "echo 'appendonly yes' > /data/redis.conf"

# 检查 Volume 内容：
docker run --rm -v redis-conf:/data busybox ls /data    
```

再使用上面的启动命令

> [!note]
>
> mac 客户端下载 Redis Insight  https://redis.io/insight/

## P14: 环境-项目结构创建&提交到码云

### Q1： gitignore配置

```tex
### 新加的
# 任意路径下
**/mvnw
**/mvnw.cmd
**/.mvn

.idea

**/.gitignore
**/.gitattributes
```

添加的同时可以通过下面查看结果

![image-20250105173705195](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501051737218.png) 

### Q2：项目配置

最完成pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns="http://maven.apache.org/POM/4.0.0"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <artifactId>Mall_Backend</artifactId>
    <groupId>com.vurtnewk.mall</groupId>
    <version>1.0-SNAPSHOT</version>
    <name>mall_backend</name>
    <packaging>pom</packaging>
    <description>聚合服务</description>

    <modules>
        <module>mall_member</module>
        <module>mall_coupon</module>
        <module>mall_order</module>
        <module>mall_product</module>
        <module>mall_ware</module>
    </modules>

</project>
```

聚合之后可以通过图中统一处理所有模块

![image-20250105173619369](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501051736438.png) 

## 15、环境-数据库初始化

### Q1: docker update

可以修改mysql等为自动启动

```shell
docker update mysql --restart=always
```

### Q2: 创建数据库

#### step1:右键创建数据库

![image-20250105181222672](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501051812737.png) 

#### step2：具体数据库上右键打开SQL控制台

![image-20250105181259779](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501051812848.png) 

#### step3: 复制并执行sql脚本

## 16、快速开发-人人开源搭建后台管理系统

https://gitee.com/renrenio

https://gitee.com/renrenio/renren-fast

### renren-fast 管理系统后端

> 下载后台管理系统

```shell
 git clone https://gitee.com/renrenio/renren-fast.git
```

> 然后删除.git文件，复制到项目中

```xml
    <modules>
        <module>mall_member</module>
        <module>mall_coupon</module>
        <module>mall_order</module>
        <module>mall_product</module>
        <module>mall_ware</module>
        <module>renren-fast</module>
    </modules>
```

> 新建数据库mall_admin

执行项目中db文件下的脚本mysql.sql

> 修改配置文件application-dev.yml

#### 错误：

> [ERROR] Maven model problem: 'parent.relativePath' of POM io.renren:renren-fast:3.0.0 (/Users/vurtnewk/Documents/data/MyProject/Mall_Backend/renren-fast/pom.xml) points at com.vurtnewk.mall:Mall_Backend instead of org.springframework.boot:spring-boot-starter-parent, please verify your project structure at /Users/vurtnewk/Documents/data/MyProject/Mall_Backend/renren-fast/pom.xml:11:10

renren-fast的plugins无法下载，报红，不影响运行

**解决方案**

renren-fast的pom.xml

```xml
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>2.6.6</version>
    <!--添加<relativePath/>-->
		<relativePath/>
	</parent>
```

### renren-fast-vue 管理系统前端

> 下载

```shell
git clone https://gitee.com/renrenio/renren-fast-vue.git
```

> 前置下载node等.

```shell
node -v
v18.20.5
```

> 因为版本不同(源码开发使用node10.x) 修改配置文件package.json

```json
"node-sass": "npm:sass@^1.69.5",
"pubsub-js": "^1.7.0",
"chromedriver": "87.0.1",
```

对这三个配置进行修改

> 运行

```shell
npm run dev
```

## 17、快速开发-逆向工程搭建&使用

### 使用人人开源/renren-generator

```shell
git clone https://gitee.com/renrenio/renren-generator.git
```

- 删除git文件，并复制到项目中

- 父pom.xml

```xml
    <modules>
        <module>mall_member</module>
        <module>mall_coupon</module>
        <module>mall_order</module>
        <module>mall_product</module>
        <module>mall_ware</module>
        <module>renren-fast</module>
+        <module>renren-generator</module>
    </modules>
```

- renren-generator的pom.xml

```xml
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>2.2.6.RELEASE</version>
+		<relativePath/>
	</parent>
```

- 修改`application.yml`里数据库的链接等

```yaml
# mysql
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    #MySQL配置
    driverClassName: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/mall_pms?useUnicode=true&characterEncoding=UTF-8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: 123456
```

- `generator.properties`

```properties
mainPath=com.vurtnewk
#\u5305\u540D
package=com.vurtnewk.mall
moduleName=product
#\u4F5C\u8005
author=vurtnewk
#Email
email=vurtnewk@gmail.com
# 表前缀，类名不会包含表前缀
tablePrefix=pms_ 
```

#### 错误

因为原来的是JDK1.8，需要修改为JDK17

- `pom.xml`

```xml
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
<!--		<version>2.2.6.RELEASE</version>-->
		<version>2.6.6</version>
		<relativePath/>
	</parent>

<!--		<java.version>1.8</java.version>-->
		<java.version>17</java.version>

<!--		<pagehelper.spring.boot.version>1.2.5</pagehelper.spring.boot.version>
		不改这里有循环依赖的错误
		-->
		<pagehelper.spring.boot.version>1.4.1</pagehelper.spring.boot.version>
```

- `application.yml`

```yaml
# 原来的
  resources:
    static-locations: classpath:/static/,classpath:/views/
       
# 改为
  web:
    resources:
      static-locations: classpath:/static/,classpath:/views/
```

### 修改逆向代码为kotlin

修改resource => template 中的模板即可

### 创建mall_common作为base模块

- 因为没有kotlin语言模块 ，直接选择java语言的模块，然后在手动创建一个kotlin目录后创建kotlin文件，再让系统自动config kotlin

- 导入renren-fast里的工具类（因为自动生成的代码里使用到了这些工具）
- pom.xml里导入公共的依赖

```xml
        <!--mybatis plus-->
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
            <version>3.5.3.1</version>
        </dependency>
        <!--lombok-->
<!--        <dependency>-->
<!--            <groupId>org.projectlombok</groupId>-->
<!--            <artifactId>lombok</artifactId>-->
<!--            <version>1.18.28</version>-->
<!--        </dependency>-->

        <dependency>
            <groupId>org.apache.httpcomponents</groupId>
            <artifactId>httpcore</artifactId>
            <version>4.4.15</version>
        </dependency>

        <dependency>
            <groupId>commons-lang</groupId>
            <artifactId>commons-lang</artifactId>
            <version>2.6</version>
        </dependency>
```

