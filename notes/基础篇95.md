## 95、仓储服务-API-仓库管理-整合ware服务&获取仓库列表

### 注意点

> - @EnableTransactionManagement 开启事务
>
> - 网关
> - 分页

![image-20250113013551885](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501130135926.png)

## 96、仓储服务-API-仓库管理-查询库存&创建采购需求

![image-20250113020843353](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501130208414.png)

## 97、仓储服务-API-仓库管理-合并采购需求

### 采购简要流程

![image-20250113021106481](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501130211511.png) 

### 查询未领取的采购单

![image-20250113152227002](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501131522034.png)

**请求方式：**

```java
GET
```

**请求地址：**

```java
/ware/purchase/unreceive/list
```

**响应数据：**

```java
{
	"msg": "success",
	"code": 0,
	"page": {
		"totalCount": 0,
		"pageSize": 10,
		"totalPage": 0,
		"currPage": 1,
		"list": [{
			"id": 1,
			"assigneeId": 1,
			"assigneeName": "aa",
			"phone": "123",
			"priority": 1,
			"status": 1,
			"wareId": 1,
			"amount": 22.0000,
			"createTime": "2019-12-12",
			"updateTime": "2019-12-12"
		}]
	}
}
```

#### 核心逻辑

```kotlin
```



### 异常

> org.springframework.web.util.NestedServletException: Handler dispatch failed; nested exception is java.lang.NoClassDefFoundError: Could not initialize class com.baomidou.mybatisplus.extension.plugins.pagination.optimize.JsqlParserCountOptimize

人人查看管理员列表时，报错

原因：common模块引入的mybatis plus和renren的版本不一致导致冲突

解决：

> renren pom.xml

```xml
		<dependency>
			<groupId>com.vurtnewk.mall</groupId>
			<artifactId>mall_common</artifactId>
			<version>1.0-SNAPSHOT</version>
			<exclusions>
				<exclusion>
					<groupId>org.mybatis</groupId>
					<artifactId>mybatis-spring</artifactId>
				</exclusion>
				<exclusion>
					<groupId>com.baomidou</groupId>
					<artifactId>mybatis-plus-boot-starter</artifactId>
				</exclusion>
				<exclusion>
					<groupId>mysql</groupId>
					<artifactId>mysql-connector-java</artifactId>
				</exclusion>
				<exclusion>
					<groupId>commons-lang</groupId>
					<artifactId>commons-lang</artifactId>
				</exclusion>
        <!--版本冲突-->
				<exclusion>
					<artifactId>jsqlparser</artifactId>
					<groupId>com.github.jsqlparser</groupId>
				</exclusion>
				<exclusion>
					<artifactId>mybatis-plus-jsqlparser</artifactId>
					<groupId>com.baomidou</groupId>
				</exclusion>
			</exclusions>
		</dependency>
```

### 合并采购需求

![image-20250113160153783](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501131601816.png)

**请求方式：**

```java
POST
```

**请求地址：**

```java
/ware/purchase/merge
```

**请求参数：**

```java
{
  purchaseId: 1, //整单id
  items:[1,2,3,4] //合并项集合
}
```

> 分页数据

**响应数据：**

```java
{
	"msg": "success",
	"code": 0
}
```

