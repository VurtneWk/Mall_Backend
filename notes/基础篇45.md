## 45、商品服务-API-三级分类-查询-递归树形结构数据获取

### 导入数据

在mysql中执行 `pms_catelog.sql` 文件数据，进行分类数据导入

其它查看代码

### 重点

- kotlin的 `asSequence()` 等于java中的 `stream()`



## 46、商品服务-API-三级分类-配置网关路由与路径重写

### 启动renren-fast后台

### 启动renren前端进行登录

### 新增一级菜单

![image-20250107012536408](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501070125437.png)

![image-20250107012614844](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501070126866.png)

### 新增二级菜单

![image-20250107012805926](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501070128946.png)

![image-20250107012841008](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501070128031.png)



![image-20250107012948767](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501070129791.png)

这里的菜单URL 在renren后端中 点击分类维护时会变成请求：http://localhost:8001/#/product-category  /变成-

### 重点：前端页面点击时和代码所在位置规则

比如点击角色管理：请求的链接是 http://localhost:8001/#/sys-role 对应的是人人前端代码中的

![image-20250107013400410](https://gitee.com/vurtnewk/typora-image/raw/master/images03/202501070134431.png) 

### 网关配置

```yaml
gateway:
	mvc:
		routes:
# lb 代表负载均衡 ，RewritePath 重写路径 把/api/(?<segment>.*) 重写成 /renren-fast/$\{segment}
    	- id: admin_route
    		uri: lb://renren-fast
    		predicates:
   	 			- Path=/api/**
    		filters:
    			- RewritePath=/api/(?<segment>.*), /renren-fast/$\{segment}
```

### 异常

```xml
	<!--1-->	
	<dependency>
			<groupId>org.springframework.cloud</groupId>
			<artifactId>spring-cloud-starter-gateway-mvc</artifactId>
		</dependency>
	<!--2-->	
		<dependency>
			<groupId>org.springframework.cloud</groupId>
			<artifactId>spring-cloud-starter-gateway</artifactId>
		</dependency>
```

如果配置的是1，则异常java.lang.ClassNotFoundException: org.springframework.cloud.loadbalancer.support.LoadBalancerClientFactory

如果配置的是2，能运行，http://localhost:88/api/captcha.jpg?uuid=d367011d-60a6-4b21-810e-d6459a82f776 请求验证码图片时503

> 解决

使用的1，然后再加上以下依赖

```xml
		<dependency>
			<groupId>org.springframework.cloud</groupId>
			<artifactId>spring-cloud-starter-loadbalancer</artifactId>
		</dependency>
```

